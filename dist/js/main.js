function initializeMap(){bounds=new google.maps.LatLngBounds;var a={zoom:14};map=new google.maps.Map(document.getElementById("map-canvas"),a),google.maps.event.addDomListener(window,"resize",function(){var a=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(a)});var b=google.maps.event.addListener(map,"bounds_changed",function(){google.maps.event.removeListener(b)});ko.applyBindings(new viewModel),map.fitBounds(bounds)}function createMarker(a){var b=this;if(this.name=a.name,this.lat=a.lat,this.lng=a.lng,this.desc=a.desc,this.label=a.label,void 0!==google){this.marker=new google.maps.Marker({position:new google.maps.LatLng(b.lat,b.lng),title:b.name,map:map,name:b.name,visible:!0}),bounds.extend(this.marker.position);var c='<div class="infoWindow"><h3>'+a.name+"</h3><p>"+a.desc+"</p></div>";google.maps.event.addListener(b.marker,"click",function(){infoWindow.setContent(c,addImage(a.name,a.desc)),infoWindow.open(map,b.marker)})}}function viewModel(){var a=this;a.nameSearch=ko.observable(""),a.markers=[];for(var b=0;b<addressesObservableArray().length;b++)a.markers.push(new createMarker(addressesObservableArray()[b]));a.filteredRecords=ko.computed(function(){return ko.utils.arrayFilter(a.markers,function(b){return 0===a.nameSearch().length||ko.utils.stringStartsWith(b.name.toLowerCase(),a.nameSearch().toLowerCase())||b.marker.setVisible(!1),0===a.nameSearch().length||ko.utils.stringStartsWith(b.name.toLowerCase(),a.nameSearch().toLowerCase())?(b.marker.setVisible(!0),0===a.nameSearch().length||ko.utils.stringStartsWith(b.name.toLowerCase(),a.nameSearch().toLowerCase())):void 0})}),a.centerMap=function(){map.setCenter(new google.maps.LatLng(this.lat,this.lng))},a.map=""}function viewModelwoMap(){var a=this;a.nameSearch=ko.observable(""),a.markers=[];for(var b=0;b<addressesObservableArray().length;b++)a.markers.push(new createMarker(addressesObservableArray()[b]));a.filteredRecords=ko.computed(function(){return ko.utils.arrayFilter(a.markers,function(b){return 0===a.nameSearch().length||ko.utils.stringStartsWith(b.name.toLowerCase(),a.nameSearch().toLowerCase())?0===a.nameSearch().length||ko.utils.stringStartsWith(b.name.toLowerCase(),a.nameSearch().toLowerCase()):void 0})}),a.centerMap=function(){},a.map='<h1 class="errorMsg">Google Map can not be loaded ! Check your proxy and/or firewall.</h1>'}function addImage(a){var b="911669b928ba82a171fb5ff4612c0d09",c=a;$.getJSON("https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key="+b+"&text="+c+"&privacy_filter=1&safe_search=1&per_page=10&format=json&jsoncallback=?").done(function(a){if(void 0!==a.photos){var b=Math.floor(Math.random()*a.photos.photo.length);console.log(b),$(".infoWindow").append('<img src="http://farm'+a.photos.photo[b].farm+".staticflickr.com/"+a.photos.photo[b].server+"/"+a.photos.photo[b].id+"_"+a.photos.photo[b].secret+'_s.jpg" alt="'+a.photos.photo[b].title+'">')}})}var addressesObservableArray=ko.observableArray([{lat:43.599548,lng:5.019535,name:"Miramas Golf",desc:"18 holes golf under the sun !",label:"Golf"},{lat:43.580706,lng:4.999503,name:"Miramas gare sncf",desc:"Some old train to see here",label:"Gare"},{lat:43.589947,lng:5.010917,name:"Lac Saint Suspi",desc:"Only the ducks can swim here !",label:"Lac Saint Suspi"},{lat:43.572448,lng:4.966266,name:"Miramas autodrome",desc:"BMW 'secret' autodrome, who knows what happend there ?",label:"Autodrome"},{lat:43.559568,lng:5.029159,name:"Miramas poudrerie",desc:"An old gun-powder factory which is now a natural Park",label:"poudrerie"}]),google,lat,lng,map,bounds,infoWindow;if(ko.utils.stringStartsWith=function(a,b){return a=a||"",b.length>a.length?!1:a.substring(0,b.length)===b},void 0!==google){var infoWindow=new google.maps.InfoWindow;$(document).ready(initializeMap)}else ko.applyBindings(new viewModelwoMap);